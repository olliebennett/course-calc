/* JavaScript for CourseCalc.com
 by Ollie Bennett [http://olliebennett.co.uk] */
function updateYearModCredsSum(year){"use strict";var total_year_mod_creds=0;$('#year'+year).find(".inputmodcreds").each(function(){total_year_mod_creds+=Number($(this).val());});$('#sum_mod_creds_year'+year).text(total_year_mod_creds);}
function updateYearWeightingsSum(){"use strict";var total_year_weight=0;$('.inputyearnumber').each(function(){total_year_weight+=Number($(this).val());});$('#year_weightings_total').text(total_year_weight);if(total_year_weight===100){$("#year_weightings_total").css('color','green');}else{$("#year_weightings_total").css('color','red');}}
function incrementModule(year){"use strict";var nummodules=parseInt($('#num_modules_year'+year).text(),10)+1;$('#num_modules_year'+year).text(nummodules);$('#year'+year).append($('<tr>').append($('<td>').append($('<input>').attr({'type':'text','id':year+'_'+nummodules+'_code','name':year+'_'+nummodules+'_code','class':'inputmodcode'}))).append($('<td>').append($('<input>').attr({'type':'text','id':year+'_'+nummodules+'_name','name':year+'_'+nummodules+'_name','class':'inputmodname'}))).append($('<td>').append($('<input>').attr({'type':'text','value':'10','id':year+'_'+nummodules+'_crds','name':year+'_'+nummodules+'_crds','class':'inputmodcreds'}))).append($('<td>').append($('<input>').attr({'type':'text','id':year+'_'+nummodules+'_mark','name':year+'_'+nummodules+'_mark','class':'inputmodmark'})).append($('<span>').text('%').attr('class','percent'))));if(nummodules===1){$('span#num_modules_plural'+year).text('module');}else{$('span#num_modules_plural'+year).text('modules');}
if($.isArray(data_modules[year][nummodules])){$('#'+year+'_'+nummodules+'_code').val(data_modules[year][nummodules][0]);$('#'+year+'_'+nummodules+'_name').val(data_modules[year][nummodules][1]);$('#'+year+'_'+nummodules+'_crds').val(data_modules[year][nummodules][2]);$('#'+year+'_'+nummodules+'_mark').val(data_modules[year][nummodules][3]);}
updateYearModCredsSum(year);}
function decrementModule(year){"use strict";var nummodules=parseInt($('#num_modules_year'+year).text(),10)-1,last_row;if(nummodules>=1){$('#num_modules_year'+year).text(nummodules);if(nummodules===1){$('span#num_modules_plural'+year).text('module');}else{$('span#num_modules_plural'+year).text('modules');}
last_row=$('#year'+year).find('tr').last();if(!$.isArray(data_modules[year][nummodules+1])){data_modules[year][nummodules+1]=[];}
data_modules[year][nummodules+1][0]=last_row.find('.inputmodcode').val();data_modules[year][nummodules+1][1]=last_row.find('.inputmodname').val();data_modules[year][nummodules+1][2]=last_row.find('.inputmodcreds').val();data_modules[year][nummodules+1][3]=last_row.find('.inputmodmark').val();last_row.remove();}
updateYearModCredsSum(year);}
function incrementYear(){"use strict";var numyears=parseInt($('#num_years').text(),10)+1,nummodules,modnum;$('#num_years').text(numyears);$("#weightings").append($('<tr>').append($('<td>').text(numyears).attr('class','yearnum')).append($('<td>').append($('<input>').attr({'type':'text','value':'0','name':'yearpercentage_'+numyears,'id':'yearpercentage_'+numyears,'class':'inputyearnumber'})).append($('<span>').text('%').attr('class','percent'))));if(!$.isArray(data_modules[numyears])){data_modules[numyears]=[];nummodules=1;}else{nummodules=(data_modules[numyears].length-1);}
if(data_yrweights[(numyears)]){$('#yearpercentage_'+(numyears)).val(data_yrweights[(numyears)]);}
$("#modules").append($('<tbody>').attr('id','year'+numyears).attr('class','yeartitle').append($('<tr>').append($('<td>').attr('colspan','4').append($('<strong>').text('Year '+numyears)).append(' (consisting of ').append($('<a>').attr('href','javascript:decrementModule(\''+numyears+'\')').text('[-]')).append(' ').append($('<span>').attr('id','num_modules_year'+numyears).text('0')).append(' ').append($('<a>').attr('href','javascript:incrementModule(\''+numyears+'\')').text('[+]')).append(' ').append($('<span>').attr('id','num_modules_plural'+numyears).text('module')).append(', totalling ').append($('<span>').attr('id','sum_mod_creds_year'+numyears).text('0')).append(' credits)'))));for(modnum=nummodules;modnum>0;modnum--){incrementModule(numyears);}
$('#year'+numyears).find('.inputmodcreds').live("blur",function(){updateYearModCredsSum(numyears);});updateYearModCredsSum(numyears);updateYearWeightingsSum();}
function decrementYear(){"use strict";var numyears=parseInt($('#num_years').text(),10),nummodules,modnum,last_row;if(numyears>1){$('#num_years').text(numyears-1);nummodules=parseInt($('#num_modules_year'+numyears).text(),10)-1;for(modnum=nummodules+1;modnum>0;modnum--){if(!$.isArray(data_modules[numyears][modnum])){data_modules[numyears][modnum]=[];}
data_modules[numyears][modnum][0]=$('#'+numyears+'_'+modnum+'_code').val();data_modules[numyears][modnum][1]=$('#'+numyears+'_'+modnum+'_name').val();data_modules[numyears][modnum][2]=$('#'+numyears+'_'+modnum+'_crds').val();data_modules[numyears][modnum][3]=$('#'+numyears+'_'+modnum+'_mark').val();}
last_row=$('#weightings').find('tr').last();data_yrweights[numyears]=last_row.find('.inputyearnumber').val();last_row.remove();$('#modules').find('tbody').last().remove();}
updateYearWeightingsSum();}
function validateForm(){"use strict";var num_errors=0,errors=[],x;updateYearWeightingsSum();if($("#year_weightings_total").text()!=='100'){errors[++num_errors]='Year weightings must sum to 100%';}
$('.inputmodcreds').each(function(){if($(this).val()===''){errors[++num_errors]='Number of credits must be specified for every module (even if incomplete).';$(this).focus();return false;}
if(!$.isNumeric($(this).val())){errors[++num_errors]='Invalid (non-numeric) value supplied for one or more module credits.';$(this).select();return false;}});$('.inputmodmark').each(function(){if(!$.isNumeric($(this).val())&&($(this).val()!=='')){errors[++num_errors]='Invalid (non-numeric) value supplied for one or more module marks.';$(this).select();return false;}});$('#results').empty();if(num_errors>0){for(x=1;x<errors.length;x++){$('#results').append('<p class="error">Error: '+errors[x]+'</p>');}
return false;}
$('#results').append('<p class="success">The form was successfully validated.</p>');return true;}
$(document).ready(function(){"use strict";$("#course").submit(function(){return validateForm();});$('.inputyearnumber').live("blur",function(){updateYearWeightingsSum();if($(this).val()===''){$(this).val('0');}});updateYearWeightingsSum();$('.inputyearnumber').live("focus",function(){if($(this).val()==='0'){$(this).val('');}});$(".copyurl").click(function(){$(this).select();});});